import pygame
import random
import sys

# Inicializar o Pygame
pygame.init()

# Ecr√£ em fullscreen
JANELA = pygame.display.set_mode((0, 0), pygame.FULLSCREEN)
pygame.display.set_caption("üé∞ Slot Machine")

# Obter dimens√µes do ecr√£
LARGURA, ALTURA = JANELA.get_size()

# Cores
BRANCO = (255, 255, 255)
VERDE = (0, 200, 0)
VERMELHO = (200, 0, 0)
CINZA = (60, 60, 60)
AMARELO = (255, 255, 0)

# Fontes com fallback autom√°tico (emoji ou texto)
try:
    FONTE = pygame.font.SysFont("Noto Color Emoji", int(ALTURA * 0.15))
except:
    FONTE = pygame.font.SysFont(None, int(ALTURA * 0.15))

FONTE_PEQUENA = pygame.font.SysFont(None, int(ALTURA * 0.04))
FONTE_MEDIA = pygame.font.SysFont(None, int(ALTURA * 0.06))


class Button:
    def __init__(self, texto, x, y, largura, altura, cor_normal, cor_hover, acao=None):
        self.texto = texto
        self.rect = pygame.Rect(x, y, largura, altura)
        self.cor_normal = cor_normal
        self.cor_hover = cor_hover
        self.acao = acao

    def desenhar(self, superficie):
        mouse = pygame.mouse.get_pos()
        clique = pygame.mouse.get_pressed()

        # Hover + clique
        if self.rect.collidepoint(mouse):
            pygame.draw.rect(superficie, self.cor_hover, self.rect, border_radius=15)
            if clique[0] and self.acao:
                pygame.time.delay(150)
                self.acao()
        else:
            pygame.draw.rect(superficie, self.cor_normal, self.rect, border_radius=15)

        # Texto do bot√£o
        texto = FONTE_PEQUENA.render(self.texto, True, BRANCO)
        superficie.blit(
            texto,
            (self.rect.x + (self.rect.width - texto.get_width()) / 2,
             self.rect.y + (self.rect.height - texto.get_height()) / 2)
        )


class SlotMachine:
    def __init__(self):
        self.simbolos = ["üçí", "üçã", "üçä", "üçâ", "‚≠ê", "üîî", "7Ô∏è‚É£"]
        self.resultado = ["‚ùì", "‚ùì", "‚ùì"]
        self.saldo = 100
        self.aposta = 10
        self.mensagem = "Clique em JOGAR"

    def rodar(self):
        if self.saldo < self.aposta:
            self.mensagem = "üí∏ Saldo insuficiente!"
            return

        self.resultado = random.choices(self.simbolos, k=3)
        self.saldo -= self.aposta
        self.verificar_resultado()

    def verificar_resultado(self):
        s1, s2, s3 = self.resultado

        if s1 == s2 == s3:
            ganho = self.aposta * 10
            self.saldo += ganho
            self.mensagem = f"üéâ JACKPOT! Ganhou {ganho}‚Ç¨!"
        elif s1 == s2 or s2 == s3 or s1 == s3:
            ganho = self.aposta * 2
            self.saldo += ganho
            self.mensagem = f"‚úî Ganhou {ganho}‚Ç¨!"
        else:
            self.mensagem = "‚ùå N√£o ganhou!"

    def desenhar(self, superficie):
        superficie.fill(CINZA)

        # Cabe√ßalho
        titulo = FONTE_MEDIA.render("üé∞ SLOT MACHINE üé∞", True, AMARELO)
        superficie.blit(titulo, ((LARGURA - titulo.get_width()) / 2, ALTURA * 0.05))

        # Mostrar resultado (centrado)
        espaco = LARGURA // 5
        inicio_x = (LARGURA - (espaco * 2)) / 2
        for i, simbolo in enumerate(self.resultado):
            texto = FONTE.render(simbolo, True, BRANCO)
            superficie.blit(texto, (inicio_x + i * espaco, ALTURA * 0.35))

        # Mostrar saldo e mensagem
        info = FONTE_PEQUENA.render(f"üí∞ Saldo: {self.saldo}‚Ç¨", True, BRANCO)
        msg = FONTE_PEQUENA.render(self.mensagem, True, BRANCO)
        superficie.blit(info, (40, 40))
        superficie.blit(msg, (40, 90))


def main():
    maquina = SlotMachine()

    def jogar():
        maquina.rodar()

    def sair():
        pygame.quit()
        sys.exit()

    # Bot√µes (centrados na parte inferior)
    largura_botao = LARGURA * 0.15
    altura_botao = ALTURA * 0.08
    y_botao = ALTURA * 0.8

    botao_jogar = Button("JOGAR", LARGURA * 0.3, y_botao, largura_botao, altura_botao, VERDE, (0, 255, 0), jogar)
    botao_sair = Button("SAIR", LARGURA * 0.55, y_botao, largura_botao, altura_botao, VERMELHO, (255, 0, 0), sair)

    clock = pygame.time.Clock()

    while True:
        for evento in pygame.event.get():
            if evento.type == pygame.QUIT or (
                evento.type == pygame.KEYDOWN and evento.key == pygame.K_ESCAPE):
                sair()

        maquina.desenhar(JANELA)
        botao_jogar.desenhar(JANELA)
        botao_sair.desenhar(JANELA)

        pygame.display.update()
        clock.tick(30)


if __name__ == "__main__":
    main()
